@using LibreriaFJDR.Models;
@using Microsoft.AspNet.Identity;
@model LibreriaFJDR.Models.Carrito
@{
    string iduser = User.Identity.GetUserId();
    LogicaCarrito logicaCarrito = new LogicaCarrito();
    LogicaLibro logicaLibro = new LogicaLibro();
    List<Libro> productos = logicaCarrito.ObtenerProductos(iduser);
    List<SelectListItem> formasPago = new List<SelectListItem>();
    Factura factura = new Factura(iduser);
    formasPago.Add(new SelectListItem() { Text = "Contrareembolso " });
    formasPago.Add(new SelectListItem() { Text = "Tarjetas de crédito" });
    formasPago.Add(new SelectListItem() { Text = "Transferencia electrónica" });
}
<head>
    <link rel="stylesheet" href="~/Content/StyleCarrito.css" />
</head>

<h2>Carrito</h2>

<div class="row">
    <div class="col-md-8">
        <section id="loginForm">
            @using (Html.BeginForm("Print", "Home", FormMethod.Get, new { @class = "form-horizontal", role = "form" }))
            {
                <div class="form-group">
                    <div class="miFormulario">
                        <input type="search" placeholder="Direccion" name="direccion" style="border-radius: 15px; border: 2px solid orange" />
                        <input type="search" placeholder="NombreApellidos" name="nombre" style="border-radius: 15px; border: 2px solid orange" />
                        <input type="search" placeholder="DNI" name="dni" pattern="[0-9]{8}[A-Za-z]{1}" title="Debe poner 8 números y una letra" style="border-radius: 15px; border: 2px solid orange" />
                        @if (logicaLibro.ValidarStock(factura.ISBNCantidad))
                        {
                            <div><input type="submit" value="Realizar Compra" class="btn btn-default" style=" border: 1px solid black;" /></div>
                        }
                    </div>
                </div>
                <div class="form-group">
                    <div class="miFormulario">
                        @Html.DropDownList("formaPago", (List<SelectListItem>)formasPago, new { @class = "form-control" })
                    </div>
                </div>
            }
        </section>
    </div>
</div>

<table style=" width: 100%;">

    <tr>
        <th>PORTADA</th>
        <th>ISBN</th>
        <th>TITULO</th>
        <th>AUTOR</th>
        <th>PRECIO</th>
        <th>UNIDADES</th>
        <th>PRECIO TOTAL</th>
        <th>OPERACIONES</th>
    </tr>

    @foreach (Libro item in productos)
    {
        <tr>
            <td><img src=@item.IMG /></td>
            <td>@item.ISBN</td>
            <td>@item.Titulo</td>
            <td>@item.Autor</td>
            <td>@item.Precio €</td>

            @{
                float precioTotal = item.Precio * @logicaCarrito.ObtenerCantidad(iduser, item.ISBN);
            }

            @if (logicaCarrito.ObtenerCantidad(iduser, item.ISBN) <= logicaLibro.ObtenerCantidad(item.ISBN))
            {
                <td style="color:forestgreen">@logicaCarrito.ObtenerCantidad(iduser, item.ISBN)</td>
            }
            else
            {
                <td style="color:red">@logicaCarrito.ObtenerCantidad(iduser, item.ISBN)/@logicaLibro.ObtenerCantidad(item.ISBN)</td>
            }
            <td class="precioTotal">@precioTotal €</td>

            <td class="operaciones">

                @using (Html.BeginForm("SumarCantidad", "Carrito", FormMethod.Get))
                {
                    @Html.Hidden("isbn", item.ISBN)
                    <input type="submit" value="+" />
                }
                @using (Html.BeginForm("RestarCantidad", "Carrito", FormMethod.Get))
                {
                    @Html.Hidden("isbn", item.ISBN)
                    <input type="submit" value="-" />
                }
                @using (Html.BeginForm("QuitarProducto", "Carrito", FormMethod.Get))
                {
                    @Html.Hidden("isbn", item.ISBN)
                    <input type="submit" value="Quitar Producto" />
                }
            </td>
        </tr>
    }

</table>


@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}